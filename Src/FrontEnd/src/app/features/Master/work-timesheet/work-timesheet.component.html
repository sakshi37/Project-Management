<p class="fs-4 fw-bold text-primary">Work Timesheet</p>

<div class="container mt-4">
  <div *ngFor="let employee of employees" class="card mb-3 shadow-sm">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div>
        <h5 class="card-title mb-1">{{ employee.name }}</h5>
        <p class="mb-0 text-muted">Employee ID: {{ employee.id }}</p>
      </div>

      <div>
        <!-- Show Tasks Button -->
        <button
          class="btn btn-outline-primary btn-sm me-2"
          (click)="toggleTaskList(employee.id)"
        >
          {{ openEmpId === employee.id ? "Hide Tasks" : "Show Tasks" }}
        </button>

        <!-- Add Task Button -->
        <button
          class="btn btn-outline-success btn-sm"
          (click)="toggleAddTaskForm(employee.id)"
        >
          {{ addTaskEmpId === employee.id ? "Cancel Add Task" : "Add Task" }}
        </button>
      </div>
    </div>

    <!-- Task List Section -->
    <div *ngIf="employee.id === openEmpId" class="card-body border-top pt-3">
      <h6 class="text-secondary mb-3">Task List</h6>

      <ng-container *ngFor="let task of taskList">
        <div
          *ngIf="task.empId === employee.id"
          class="d-flex flex-column gap-1 mb-3 border-bottom pb-2"
        >
          <p class="mb-1 fw-semibold">Job ID: {{ task.jobId }}</p>
          <small class="text-muted">
            Activity: {{ task.activity }} | Sequence: {{ task.sequence }} |
            Type: {{ task.type }} | Part: {{ task.part }}
          </small>
        </div>
      </ng-container>
    </div>

    <!-- Add Task Form Section -->
    <div *ngIf="employee.id === addTaskEmpId" class="card-body border-top pt-3">
      <h6 class="text-secondary mb-3">Add New Task</h6>

      <form
        [formGroup]="taskForm"
        (ngSubmit)="onSubmit(employee.id)"
        class="mt-4"
      >
        <div class="mb-3">
          <label for="jobId" class="form-label">Job ID</label>
          <input
            id="jobId"
            type="text"
            class="form-control"
            formControlName="jobId"
            required
          />
        </div>

        <div class="mb-3">
          <label for="activity" class="form-label">Activity</label>
          <input
            id="activity"
            type="text"
            class="form-control"
            formControlName="activity"
            required
          />
        </div>

        <div class="mb-3">
          <label for="sequence" class="form-label">Sequence</label>
          <input
            id="sequence"
            type="text"
            class="form-control"
            formControlName="sequence"
          />
        </div>

        <div class="mb-3">
          <label for="part" class="form-label">Part</label>
          <input
            id="part"
            type="text"
            class="form-control"
            formControlName="part"
          />
        </div>

        <div class="mb-3">
          <label for="type" class="form-label">Type</label>
          <input
            id="type"
            type="text"
            class="form-control"
            formControlName="type"
          />
        </div>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="taskForm.invalid"
        >
          Add Task
        </button>
      </form>
    </div>
  </div>
</div>
