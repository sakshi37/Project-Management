<div class="container">
  <br />
  <h5 class="mb-3">üõ°Ô∏è Admin Guardian Panel</h5>
  <hr class="my-2" />

  <p *ngIf="isLoading">Loading requests...</p>

  <!-- Search + Entries Dropdown -->
  <div class="mb-3 d-flex align-items-center justify-content-between flex-wrap">
    <!-- Show Entries Dropdown -->
    <div class="entries-dropdown d-flex align-items-center mb-2">
      <label for="entries" class="me-2">Show</label>
      <select
        id="entries"
        class="form-select form-select-sm"
        style="width: auto"
        [(ngModel)]="pageSize"
        (change)="currentPage = 1"
      >
        <option *ngFor="let option of itemsPerPageOptions" [value]="option">
          {{ option }}
        </option>
      </select>
      <span class="ms-2">entries</span>
    </div>

    <!-- Search Input -->
    <div class="d-flex align-items-center mb-2">
      <label for="search" class="me-2">Search:</label>
      <input
        id="search"
        type="text"
        class="form-control form-control-sm"
        style="width: 300px"
        [(ngModel)]="searchTerm"
        (input)="filterRequests()"
        placeholder="Search by employee/requested by"
      />
    </div>
  </div>

  <!-- Table -->
  <table
    *ngIf="!isLoading && filteredRequests.length > 0"
    class="mb-0"
  >
    <thead>
      <tr>
        <th>
          <div class="head-first">Sr. No</div>
        </th>
        <th>
          <div class="head-other">Request Date</div>
        </th>
        <th>
          <div class="head-other">Employee Name</div>
        </th>
        <th>
          <div class="head-other">Requested By</div>
        </th>
        <th>
          <div class="head-other">Reason</div>
        </th>
        <th>
          <div class="head-last">Actions</div>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="
          let req of filteredRequests
            | paginate : { itemsPerPage: pageSize, currentPage: currentPage };
          let i = index
        "
      >
        <td>
          <div class="tr-first-child">
            {{ (currentPage - 1) * pageSize + i + 1 }}
          </div>
        </td>
        <td>
          <div class="tr-other-child">
            {{ req.requestDate | date : "yyyy-MM-dd" }}
          </div>
        </td>
        <td>
          <div class="tr-other-child">{{ req.employeeName }}</div>
        </td>
        <td>
          <div class="tr-other-child">{{ req.requestByName }}</div>
        </td>
        <td>
          <div class="tr-other-child">{{ req.reason }}</div>
        </td>
        <td>
          <div class="tr-last-child">
            <button
              mat-icon-button
              (click)="openApproveRequestPopup(req)"
              title="Approve"
            >
              <mat-icon style="color: green">check_circle</mat-icon></button
            ><button
              mat-icon-button
              title="Reject"
              (click)="openRejectRequestPopup(req)"
            >
              <mat-icon style="color: red">cancel</mat-icon>
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination Controls -->
  <div class="pagination-wrapper" *ngIf="filteredRequests.length > pageSize">
    <pagination-controls
      (pageChange)="currentPage = $event"
      [autoHide]="true"
    ></pagination-controls>
  </div>

  <p *ngIf="!isLoading && filteredRequests.length === 0">
    No pending requests.
  </p>
</div>
